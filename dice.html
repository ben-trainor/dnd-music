<!doctype html>
<html lang="en">

    <head>
        <title>Roll dice</title>
        <!-- Required meta tags -->
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

        <!-- Bootstrap CSS v5.0.2 -->
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"  integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
        <link rel="stylesheet" href="css/main.css">
        <script>

            window.onload = function() {


                const TIMEOUT = 2000;
                var alertID = "";

                var rolling = false;
                var rollNumber = 0;
                
                var rollButtonElements = document.getElementsByClassName("roll-button");
                var rollButtonIDs = Array;

                var alert = document.createElement('div');
                alert.className = "alert alert-warning alert-dismissible fade show position-absolute shadow text-center top-0 left-50 mt-3 p-3";
                var rollingMsg = document.createElement('div');
                rollingMsg.className = "rollingMsg fw-normal float-end ms-3";
                rollingMsg.innerHTML = "Rolling..."
                var spinner = document.createElement('div');
                spinner.className = "spinner-border roll-spinner float-end fs-5 text-dark";

                storeButtons();
                setButtons();

                // Store button IDs for later use
                function storeButtons() {
                    for (let i = 0; i < rollButtonElements.length; i++) {
                        rollButtonIDs[i] = rollButtonElements.item(i).id.toString();
                    }
                }

                // Generate onclick events for each button with class "roll-button"
                function setButtons() {
                    for (let i = 0; i < rollButtonElements.length; i++) {
                        rollButtonElements.item(i).addEventListener("click", function() {
                            tryToRoll(this.id);
                        });
                    }
                }

                function tryToRoll(rollID) {

                    if (rolling == true) {
                        console.log("Roll in progress...");
                    }
                    else {
                        roll(rollID);
                    }

                }

                function roll(rollID) {
                    
                    rolling = true;
                    clearTimeout(alertID);
                    
                    console.log("Rolling a D" + rollID);
                    document.getElementById(rollID).append(rollingMsg);
                    document.getElementById(rollID).append(spinner);

                    setTimeout(() => {
                        document.getElementById("full_page").append(alert);
                        rollNumber = getRandomIntInclusive(1, rollID);

                        if (rollNumber == 20) {
                            alert.innerHTML = "Rolled a nat 20!";
                        }
                        else {
                            alert.innerHTML = "Rolled " + rollNumber;
                        }

                        rollingMsg.remove();
                        spinner.remove();

                        rolling = false;

                    }, TIMEOUT);

                    alertID = setTimeout(() => {
                        alert.remove();
                    }, TIMEOUT*3);

                }

                function getRandomIntInclusive(min, max) {
                    min = Math.ceil(min);
                    max = Math.floor(max);
                    return Math.floor(Math.random() * (max - min + 1) + min);
                }
                
                
            }
            
        </script>
        
    </head>


    <body class="row p-0 m-0" id="full_page">

        <!-- Offcanvas menu -->
        <header>

            <nav class="navbar navbar-dark position-absolute top-0 start-0 m-0 p-2">
                <button class="navbar-toggler bg-second" type="button" data-bs-toggle="offcanvas" data-bs-target="#navbarToggleExternalContent" aria-controls="navbarToggleExternalContent" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
            </nav>

              
            <div class="offcanvas offcanvas-start rounded-end" tabindex="-1" id="navbarToggleExternalContent" aria-labelledby="offcanvasExampleLabel">
                
                <!-- Menu title -->
                <div class="offcanvas-header m-0 p-3 px-4">
                    <h4 class="offcanvas-title" id="offcanvasExampleLabel">DND-MUSIC</h4>
                    <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
                </div>

                <!-- Menu stuff -->
                <div class="row offcanvas-body m-0 p-0 fs-5" id="menu">

                    <div class="list-group list-group-flush rounded m-0 p-2">
                        <a class="list-group-item list-group-item-action p-3" href="index.html">soundboard</a>
                        <a class="list-group-item list-group-item-action p-3" href="dice.html">dice rolling</a>
                        <a class="list-group-item list-group-item-action p-3" href="database.html">music database</a>
                        <a class="list-group-item list-group-item-action p-3" href="about.html">about this project</a>
                        <a class="list-group-item list-group-item-action p-3" href="support.html">support/contribute</a>
                    </div>

                </div>
                    
                <div class="" id="mixer">
                </div>

                <div class="bottom-0 px-4" id="copyright">
                    <p>&copy;2021 ben trainor</p>
                </div>

            </div>

        </header>



            
        <div class="row bg-dark text-center m-0 p-0">

            <div class="col-xl-2 col-sm-1"></div>

            <!-- Ambience -->
            <div class="col-xl-8 col-sm-10 text-dark p-md-0 p-0 m-0 gap-0 single-container">

                <div class="row m-0 p-0 py-4" id="ambience">
                    
                    <h1 class="text-sh-dark text-light mb-xl-4 mb-4">ROLL YOUR DICE</h1>

                </div>


                <div class="row  m-0 p-0">

                    <ul class="row list-group-flush roll-group text-start m-0 px-xl-4 py-xl-4 py-3 p-3 gap-xl-4 gap-3 rounded">
                        <button id="4" class="list-group-item list-group-item-action roll-button fw-bold fs-5 p-4 border-1 rounded">D4</button>
                        <button id="6" class="list-group-item list-group-item-action roll-button fw-bold fs-5 p-4 border-1 rounded">D6</button>
                        <button id="8" class="list-group-item list-group-item-action roll-button fw-bold fs-5 p-4 border-1 rounded">D8</button>
                        <button id="10" class="list-group-item list-group-item-action roll-button fw-bold fs-5 p-4 border-1 rounded">D10</button>
                        <button id="12" class="list-group-item list-group-item-action roll-button fw-bold fs-5 p-4 border-1 rounded">D12</button>
                        <button id="20" class="list-group-item list-group-item-action roll-button fw-bold fs-5 p-4 border-1 rounded">D20</button>
                    </ul>
                    
                </div>

                
            </div>


        </div>

        
        
        
        <!-- Bootstrap JavaScript Libraries -->
        <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js" integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js" integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF" crossorigin="anonymous"></script>
        
    </body>
    
</html>